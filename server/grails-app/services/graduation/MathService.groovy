package graduation

import graduation.constants.ScriptConstants
import graduation.models.Calculations
import grails.transaction.Transactional

@Transactional(readOnly = true)
class MathService {

    static final Integer Lag = 364

    def reformationService
    def coefficientService
    def fileService
    def noiseService
    def pythonRunService

//    List<Double> list = [ 38.0, - 11.0,
//    - 9.0,
//    12.0,
//    - 15.0,
//    20.0,
//    4.0,
//    - 54.0,
//    90.0,
//    - 94.0,
//    67.0,
//    - 31.0,
//    3.0,
//    32.0,
//    - 55.0,
//    34.0,
//    9.0,
//    - 45.0,
//    59.0,
//    - 49.0,
//    47.0,
//    - 59.0,
//    48.0,
//    - 17.0,
//    - 3.0,
//    16.0,
//    - 35.0,
//    48.0,
//    - 34.0,
//    5.0,
//    1.0,
//    8.0,
//    - 6.0,
//    0.0,
//    21.0,
//    - 59.0,
//    72.0,
//    - 56.0,
//    43.0,
//    - 34.0,
//    32.0,
//    - 50.0,
//    59.0,
//    - 33.0,
//    5.0,
//    - 2.0,
//    5.0,
//    3.0,
//    - 23.0,
//    43.0,
//    - 37.0,
//    7.0,
//    15.0,
//    - 22.0,
//    8.0,
//    43.0,
//    - 82.0,
//    60.0,
//    - 25.0,
//    29.0,
//    - 49.0,
//    39.0,
//    - 18.0,
//    50.0,
//    - 100.0,
//    75.0,
//    1.0,
//    - 49.0,
//    69.0,
//    - 82.0,
//    72.0,
//    - 32.0,
//    - 23.0,
//    65.0,
//    - 67.0,
//    36.0,
//    1.0,
//    - 25.0,
//    27.0,
//    - 16.0,
//    22.0,
//    - 55.0,
//    66.0,
//    - 23.0,
//    - 20.0,
//    20.0,
//    - 7.0,
//    10.0,
//    - 8.0,
//    - 39.0,
//    103.0,
//    - 108.0,
//    83.0,
//    - 97.0,
//    97.0,
//    - 44.0,
//    11.0,
//    - 23.0,
//    41.0,
//    - 56.0,
//    52.0,
//    - 24.0,
//    6.0,
//    - 5.0,
//    15.0,
//    - 36.0,
//    59.0,
//    - 68.0,
//    40.0,
//    - 14.0,
//    54.0,
//    - 108.0,
//    87.0,
//    1.0,
//    - 92.0,
//    130.0,
//    - 105.0,
//    59.0,
//    - 33.0,
//    39.0,
//    - 59.0,
//    56.0,
//    - 28.0,
//    13.0,
//    - 17.0,
//    8.0,
//    23.0,
//    - 49.0,
//    48.0,
//    - 38.0,
//    43.0,
//    - 48.0,
//    41.0,
//    - 36.0,
//    30.0,
//    - 20.0,
//    32.0,
//    - 73.0,
//    101.0,
//    - 77.0,
//    17.0,
//    35.0,
//    - 56.0,
//    49.0,
//    - 27.0,
//    - 6.0,
//    50.0,
//    - 75.0,
//    52.0,
//    - 20.0,
//    34.0,
//    - 74.0,
//    74.0,
//    - 24.0,
//    - 14.0,
//    0.0,
//    39.0,
//    - 48.0,
//    27.0,
//    - 44.0,
//    100.0,
//    - 109.0,
//    49.0,
//    2.0,
//    10.0,
//    - 41.0,
//    23.0,
//    44.0,
//    - 105.0,
//    117.0,
//    - 89.0,
//    65.0,
//    - 62.0,
//    64.0,
//    - 62.0,
//    45.0,
//    - 1.0,
//    - 48.0,
//    67.0,
//    - 49.0,
//    5.0,
//    45.0,
//    - 67.0,
//    44.0,
//    - 9.0,
//    - 1.0,
//    - 8.0,
//    22.0,
//    - 31.0,
//    19.0,
//    4.0,
//    - 11.0,
//    6.0,
//    - 16.0,
//    45.0,
//    - 68.0,
//    62.0,
//    - 25.0,
//    - 13.0,
//    17.0,
//    - 7.0,
//    24.0,
//    - 43.0,
//    21.0,
//    13.0,
//    - 20.0,
//    11.0,
//    - 5.0,
//    21.0,
//    - 54.0,
//    62.0,
//    - 52.0,
//    56.0,
//    - 40.0,
//    - 12.0,
//    35.0,
//    5.0,
//    - 55.0,
//    69.0,
//    - 71.0,
//    86.0,
//    - 76.0,
//    13.0,
//    52.0,
//    - 65.0,
//    26.0,
//    35.0,
//    - 63.0,
//    36.0,
//    - 9.0,
//    14.0,
//    - 17.0,
//    8.0,
//    - 10.0,
//    17.0,
//    - 9.0,
//    - 11.0,
//    21.0,
//    0.0,
//    - 35.0,
//    41.0,
//    - 22.0,
//    20.0,
//    - 42.0,
//    66.0,
//    - 67.0,
//    24.0,
//    27.0,
//    - 28.0,
//    10.0,
//    - 25.0,
//    38.0,
//    - 23.0,
//    29.0,
//    - 63.0,
//    49.0,
//    33.0,
//    - 90.0,
//    64.0,
//    - 11.0,
//    - 7.0,
//    - 8.0,
//    28.0,
//    - 36.0,
//    36.0,
//    - 44.0,
//    58.0,
//    - 62.0,
//    51.0,
//    - 25.0,
//    1.0,
//    - 5.0,
//    25.0,
//    - 37.0,
//    49.0,
//    - 63.0,
//    55.0,
//    - 27.0,
//    3.0,
//    17.0,
//    - 22.0,
//    - 14.0,
//    59.0,
//    - 60.0,
//    35.0,
//    - 23.0,
//    19.0,
//    - 13.0,
//    8.0,
//    - 5.0,
//    4.0,
//    - 3.0,
//    - 2.0,
//    6.0,
//    6.0,
//    - 35.0,
//    57.0,
//    - 54.0,
//    36.0,
//    - 16.0,
//    15.0,
//    - 44.0,
//    52.0,
//    - 14.0,
//    - 13.0,
//    9.0,
//    - 13.0,
//    21.0,
//    - 1.0,
//    - 26.0,
//    25.0,
//    - 16.0,
//    29.0,
//    - 45.0,
//    42.0,
//    - 30.0,
//    10.0,
//    11.0,
//    - 8.0,
//    2.0,
//    - 29.0,
//    58.0,
//    - 48.0,
//    15.0,
//    16.0,
//    - 41.0,
//    51.0,
//    - 36.0,
//    9.0,
//    14.0,
//    - 32.0,
//    29.0,
//    9.0,
//    - 49.0,
//    54.0,
//    - 37.0,
//    30.0,
//    - 45.0,
//    65.0,
//    - 55.0,
//    11.0,
//    34.0,
//    - 70.0,
//    108.0,
//    - 111.0,
//    38.0,
//    45.0,
//    - 45.0,
//    - 15.0,
//    52.0,
//    - 37.0,
//    9.0,
//    - 32.0,
//    94.0,
//    - 90.0,
//    3.0,
//    45.0,
//    - 7.0,
//    - 30.0,
//    30.0,
//    - 31.0,
//    34.0,
//    - 25.0,
//    16.0,
//    - 6.0,
//    - 22.0,
//    53.0,
//    - 69.0,
//    70.0,
//    - 39.0,
//    4.0,
//    - 35.0,
//    116.0,
//    - 163.0,
//    144.0,
//    - 87.0,
//    28.0,
//    17.0,
//    - 52.0,
//    64.0,
//    - 38.0,
//    - 1.0,
//    22.0,
//    - 20.0,
//    9.0,
//    - 8.0,
//    14.0,
//    0.0,
//    - 40.0,
//    62.0,
//    - 32.0,
//    - 14.0,
//    27.0,
//    - 6.0,
//    - 41.0,
//    101.0,
//    - 116.0,
//    78.0,
//    - 52.0,
//    39.0,
//    - 3.0,
//    - 50.0,
//    92.0,
//    - 86.0,
//    35.0,
//    6.0,
//    - 11.0,
//    9.0,
//    - 21.0,
//    18.0,
//    23.0,
//    - 68.0,
//    79.0,
//    - 53.0,
//    19.0,
//    - 26.0,
//    73.0,
//    - 111.0,
//    133.0,
//    - 134.0,
//    77.0,
//    6.0,
//    - 50.0,
//    55.0,
//    - 40.0,
//    21.0,
//    - 13.0,
//    18.0,
//    - 49.0,
//    87.0,
//    - 79.0,
//    25.0,
//    40.0,
//    - 94.0,
//    114.0,
//    - 97.0,
//    71.0,
//    - 42.0,
//    - 3.0,
//    34.0,
//    - 7.0,
//    - 56.0,
//    83.0,
//    - 45.0,
//    - 7.0,
//    25.0,
//    - 25.0,
//    31.0,
//    - 39.0,
//    44.0,
//    - 45.0,
//    42.0,
//    - 42.0,
//    35.0,
//    3.0,
//    - 53.0,
//    79.0,
//    - 97.0,
//    118.0,
//    - 112.0,
//    81.0,
//    - 54.0,
//    49.0,
//    - 72.0,
//    88.0,
//    - 59.0,
//    3.0,
//    45.0,
//    - 54.0,
//    7.0,
//    56.0,
//    - 86.0,
//    82.0,
//    - 60.0,
//    43.0,
//    - 49.0,
//    59.0,
//    - 45.0,
//    15.0,
//    12.0,
//    - 40.0,
//    46.0,
//    - 3.0,
//    - 41.0,
//    48.0,
//    - 52.0,
//    67.0,
//    - 54.0,
//    8.0,
//    3.0,
//    48.0,
//    - 79.0,
//    38.0,
//    5.0,
//    11.0,
//    - 53.0,
//    76.0,
//    - 71.0,
//    47.0,
//    - 10.0,
//    - 28.0,
//    28.0,
//    26.0,
//    - 90.0,
//    114.0,
//    - 89.0,
//    33.0,
//    28.0,
//    - 68.0,
//    80.0,
//    - 58.0,
//    - 11.0,
//    91.0,
//    - 122.0,
//    107.0,
//    - 96.0,
//    116.0,
//    - 143.0,
//    142.0,
//    - 113.0,
//    76.0,
//    - 57.0,
//    61.0,
//    - 53.0,
//    25.0,
//    - 16.0,
//    33.0,
//    - 34.0,
//    7.0,
//    6.0,
//    3.0,
//    19.0,
//    - 83.0,
//    123.0,
//    - 99.0,
//    61.0,
//    - 63.0,
//    80.0,
//    - 78.0,
//    64.0,
//    - 29.0,
//    - 32.0,
//    74.0,
//    - 74.0,
//    64.0,
//    - 62.0,
//    57.0,
//    - 47.0,
//    44.0,
//    - 47.0,
//    41.0,
//    - 28.0,
//    24.0,
//    - 28.0,
//    29.0,
//    - 38.0,
//    57.0,
//    - 51.0,
//    20.0,
//    - 12.0,
//    36.0,
//    - 53.0,
//    42.0,
//    - 21.0,
//    12.0,
//    - 8.0,
//    - 18.0,
//    56.0,
//    - 62.0,
//    47.0,
//    - 49.0,
//    43.0,
//    - 1.0,
//    - 46.0,
//    53.0,
//    - 8.0,
//    - 30.0,
//    0.0,
//    41.0,
//    - 24.0,
//    - 9.0,
//    12.0,
//    7.0,
//    - 51.0,
//    107.0,
//    - 116.0,
//    59.0,
//    8.0,
//    - 29.0,
//    6.0,
//    29.0,
//    - 65.0,
//    82.0,
//    - 50.0,
//    4.0,
//    5.0,
//    8.0,
//    - 23.0,
//    46.0,
//    - 69.0,
//    83.0,
//    - 80.0,
//    50.0,
//    - 18.0,
//    23.0,
//    - 60.0,
//    86.0,
//    - 73.0,
//    42.0,
//    - 34.0,
//    43.0,
//    - 24.0,
//    - 15.0,
//    21.0,
//    - 6.0,
//    14.0,
//    - 17.0,
//    - 11.0,
//    31.0,
//    - 35.0,
//    49.0,
//    - 55.0,
//    34.0,
//    - 5.0,
//    - 18.0,
//    22.0,
//    6.0,
//    - 48.0,
//    80.0,
//    - 90.0,
//    74.0,
//    - 47.0,
//    33.0,
//    - 42.0,
//    58.0,
//    - 68.0,
//    71.0,
//    - 54.0,
//    33.0,
//    - 52.0,
//    101.0,
//    - 119.0,
//    82.0,
//    - 22.0,
//    - 38.0,
//    81.0,
//    - 64.0,
//    1.0,
//    28.0,
//    - 18.0,
//    6.0,
//    24.0,
//    - 61.0,
//    62.0,
//    - 25.0,
//    - 9.0,
//    - 9.0,
//    61.0,
//    - 66.0,
//    8.0,
//    41.0,
//    - 35.0,
//    0.0,
//    19.0,
//    - 17.0,
//    6.0,
//    31.0,
//    - 81.0,
//    93.0,
//    - 78.0,
//    66.0,
//    - 25.0,
//    - 35.0,
//    49.0,
//    - 26.0,
//    15.0,
//    - 12.0,
//    - 10.0,
//    37.0,
//    - 36.0,
//    24.0,
//    - 23.0,
//    10.0,
//    9.0,
//    - 7.0,
//    12.0,
//    - 41.0,
//    43.0,
//    - 3.0,
//    - 19.0,
//    9.0,
//    - 14.0,
//    32.0,
//    - 26.0,
//    - 10.0,
//    53.0,
//    - 54.0,
//    9.0,
//    2.0,
//    39.0,
//    - 53.0,
//    33.0,
//    - 45.0,
//    60.0,
//    - 26.0,
//    12.0,
//    - 48.0,
//    76.0,
//    - 101.0,
//    116.0,
//    - 57.0,
//    - 39.0,
//    58.0,
//    5.0,
//    - 61.0,
//    71.0,
//    - 71.0,
//    104.0,
//    - 135.0,
//    96.0,
//    - 31.0,
//    25.0,
//    - 45.0,
//    30.0,
//    - 4.0,
//    6.0,
//    - 13.0,
//    16.0,
//    4.0,
//    ]
//
//    List<Double> valueList = [2247.97,
//                               -1653.24,
//                               516.13,
//                               555.96,
//                               -430.05,
//                               -578.25,
//                               1059.72,
//                               -856.12,
//                               439.7,
//                               -279.44,
//                               453.35,
//                               -340.69,
//                               148.72,
//                               -85.12,
//                               -468.09,
//                               1119.98,
//                               -1095.61,
//                               604.25,
//                               -354.39,
//                               593.45,
//                               -648.09,
//                               251.0,
//                               -53.51,
//                               44.59,
//                               255.75,
//                               -299.67,
//                               -151.07,
//                               431.8,
//                               -640.92,
//                               699.05,
//                               -638.62,
//                               836.96,
//                               -487.57,
//                               -199.9,
//                               339.25,
//                               -401.78,
//                               327.68,
//                               184.54,
//                               -230.68,
//                               -323.19,
//                               391.92,
//                               -199.14,
//                               586.43,
//                               -823.46,
//                               365.77,
//                               -5.22,
//                               -267.91,
//                               759.01,
//                               -900.59,
//                               556.34,
//                               -304.67,
//                               405.16,
//                               -701.13,
//                               763.82,
//                               -158.72,
//                               5.65,
//                               -823.66,
//                               860.36,
//                               46.49,
//                               -511.11,
//                               244.37,
//                               175.34,
//                               87.48,
//                               -375.36,
//                               -328.36,
//                               670.89,
//                               45.85,
//                               -101.26,
//                               -641.23,
//                               408.53,
//                               191.14,
//                               125.38,
//                               -499.51,
//                               479.16,
//                               -561.84,
//                               738.88,
//                               -419.03,
//                               -179.69,
//                               68.99,
//                               326.76,
//                               -233.16,
//                               -156.6,
//                               615.84,
//                               -344.8,
//                               -602.81,
//                               535.7,
//                               331.2,
//                               -437.39,
//                               -36.99,
//                               -135.88,
//                               1588.42,
//                               -2686.11,
//                               2073.01,
//                               -1906.43,
//                               2612.35,
//                               -1970.1,
//                               614.96,
//                               -141.24,
//                               265.2,
//                               -941.36,
//                               1931.55,
//                               -2129.99,
//                               1586.47,
//                               -412.99,
//                               -763.03,
//                               768.89,
//                               -415.52,
//                               206.83,
//                               -3.49,
//                               -84.9,
//                               610.22,
//                               -945.13,
//                               227.17,
//                               695.57,
//                               -1370.31,
//                               1671.4,
//                               -963.86,
//                               -71.12,
//                               342.8,
//                               -212.25,
//                               151.25,
//                               29.38,
//                               -246.87,
//                               309.75,
//                               -204.65,
//                               -59.66,
//                               346.98,
//                               -410.07,
//                               162.03,
//                               -86.32,
//                               279.64,
//                               -129.9,
//                               -129.72,
//                               -45.27,
//                               297.91,
//                               -484.64,
//                               785.52,
//                               -967.06,
//                               1119.63,
//                               -1195.98,
//                               800.82,
//                               -322.1,
//                               324.96,
//                               -647.01,
//                               923.32,
//                               -984.59,
//                               745.57,
//                               -600.83,
//                               752.76,
//                               -508.06,
//                               -127.27,
//                               291.24,
//                               27.18,
//                               -128.54,
//                               -35.05,
//                               -26.44,
//                               527.07,
//                               -596.1,
//                               -515.78,
//                               540.54,
//                               1681.37,
//                               -2890.21,
//                               1236.3,
//                               831.6,
//                               -771.04,
//                               -483.74,
//                               1011.05,
//                               -743.57,
//                               145.48,
//                               542.91,
//                               -605.85,
//                               9.53,
//                               133.28,
//                               195.31,
//                               -116.3,
//                               -223.95,
//                               415.27,
//                               -602.87,
//                               925.53,
//                               -1305.88,
//                               1060.67,
//                               -156.96,
//                               -306.15,
//                               177.67,
//                               -216.05,
//                               614.93,
//                               -806.89,
//                               473.12,
//                               22.71,
//                               -201.84,
//                               46.82,
//                               27.35,
//                               -59.57,
//                               256.61,
//                               -338.26,
//                               175.86,
//                               -14.12,
//                               116.51,
//                               -261.06,
//                               90.0,
//                               123.46,
//                               44.77,
//                               -478.65,
//                               521.46,
//                               -133.69,
//                               112.49,
//                               -465.17,
//                               369.7,
//                               443.09,
//                               -1148.0,
//                               736.78,
//                               251.07,
//                               -504.96,
//                               173.17,
//                               -28.63,
//                               236.62,
//                               -419.81,
//                               127.76,
//                               185.55,
//                               -115.53,
//                               -3.97,
//                               79.83,
//                               -89.22,
//                               -47.74,
//                               143.23,
//                               -228.42,
//                               463.7,
//                               -526.49,
//                               229.04,
//                               80.93,
//                               -185.67,
//                               107.52,
//                               -19.92,
//                               -5.86,
//                               123.13,
//                               -264.33,
//                               338.15,
//                               -412.19,
//                               559.56,
//                               -737.52,
//                               759.73,
//                               -511.08,
//                               174.71,
//                               -85.76,
//                               257.5,
//                               -595.64,
//                               876.66,
//                               -886.95,
//                               1222.73,
//                               -1940.62,
//                               1752.08,
//                               -567.26,
//                               -271.44,
//                               234.96,
//                               116.3,
//                               -140.45,
//                               127.7,
//                               -424.28,
//                               623.47,
//                               -620.54,
//                               427.51,
//                               -81.76,
//                               0.53,
//                               -270.62,
//                               601.98,
//                               -738.45,
//                               621.13,
//                               -462.76,
//                               461.03,
//                               -541.44,
//                               410.92,
//                               -34.81,
//                               -111.32,
//                               -141.58,
//                               358.71,
//                               -429.61,
//                               406.05,
//                               -189.83,
//                               108.27,
//                               -49.09,
//                               -256.76,
//                               154.6,
//                               412.9,
//                               -530.55,
//                               141.41,
//                               -97.12,
//                               432.52,
//                               -507.91,
//                               52.34,
//                               280.66,
//                               45.68,
//                               -196.52,
//                               -170.12,
//                               551.95,
//                               -405.25,
//                               -338.92,
//                               633.62,
//                               -197.19,
//                               102.39,
//                               -327.96,
//                               107.56,
//                               15.02,
//                               100.67,
//                               18.52,
//                               -116.5,
//                               90.18,
//                               -0.86,
//                               79.01,
//                               -142.03,
//                               -195.36,
//                               286.18,
//                               -42.71,
//                               143.2,
//                               -300.72,
//                               193.51,
//                               -205.21,
//                               142.82,
//                               91.63,
//                               285.77,
//                               -978.26,
//                               770.12,
//                               124.04,
//                               -636.43,
//                               660.94,
//                               -355.11,
//                               -298.27,
//                               654.87,
//                               -332.8,
//                               -40.37,
//                               74.15,
//                               -155.92,
//                               372.93,
//                               -289.21,
//                               -189.55,
//                               411.23,
//                               -98.87,
//                               53.43,
//                               -368.64,
//                               554.39,
//                               -720.93,
//                               663.48,
//                               -45.14,
//                               -476.97,
//                               569.25,
//                               -1046.49,
//                               1089.01,
//                               367.63,
//                               -1453.1,
//                               772.13,
//                               420.6,
//                               -799.6,
//                               290.71,
//                               -76.11,
//                               1164.64,
//                               -1900.68,
//                               711.22,
//                               650.36,
//                               -388.24,
//                               -298.99,
//                               158.35,
//                               -176.5,
//                               608.33,
//                               -668.15,
//                               297.04,
//                               154.78,
//                               -663.1,
//                               1146.57,
//                               -792.93,
//                               262.4,
//                               -490.08,
//                               751.01,
//                               -1048.9,
//                               1578.22,
//                               -1514.84,
//                               761.71,
//                               -246.78,
//                               -3.79,
//                               169.84,
//                               -127.23,
//                               447.94,
//                               -835.83,
//                               574.32,
//                               -174.55,
//                               153.19,
//                               -301.76,
//                               255.94,
//                               50.81,
//                               -270.53,
//                               -5.48,
//                               347.71,
//                               -54.15,
//                               -465.09,
//                               529.76,
//                               -33.09,
//                               -369.05,
//                               552.17,
//                               -694.01,
//                               173.6,
//                               264.88,
//                               -242.19,
//                               344.79,
//                               -229.99,
//                               216.53,
//                               -428.63,
//                               477.8,
//                               -638.49,
//                               770.63,
//                               -594.49,
//                               299.97,
//                               88.14,
//                               -251.28,
//                               112.48,
//                               -125.65,
//                               -55.11,
//                               354.12,
//                               -152.98,
//                               88.19,
//                               -299.83,
//                               267.13,
//                               -517.25,
//                               537.34,
//                               167.49,
//                               -341.49,
//                               291.23,
//                               -777.25,
//                               773.52,
//                               -123.71,
//                               -375.8,
//                               260.27,
//                               250.09,
//                               -253.87,
//                               -186.52,
//                               297.0,
//                               -186.09,
//                               405.31,
//                               -458.11,
//                               -169.31,
//                               599.16,
//                               -355.2,
//                               93.27,
//                               -103.63,
//                               -26.48,
//                               416.51,
//                               -403.32,
//                               -70.58,
//                               136.62,
//                               106.85,
//                               95.54,
//                               -592.55,
//                               637.44,
//                               -115.49,
//                               -185.15,
//                               -118.73,
//                               522.28,
//                               -256.93,
//                               -1104.1,
//                               2283.89,
//                               -2388.78,
//                               2883.94,
//                               -3344.94,
//                               2204.37,
//                               -794.72,
//                               278.1,
//                               -403.48,
//                               1137.13,
//                               -1699.7,
//                               1324.8,
//                               -93.01,
//                               -1110.2,
//                               875.02,
//                               174.41,
//                               -505.79,
//                               519.1,
//                               -617.14,
//                               585.46,
//                               -540.81,
//                               415.0,
//                               -349.04,
//                               339.1,
//                               -330.91,
//                               228.97,
//                               314.01,
//                               -386.9,
//                               -174.98,
//                               326.28,
//                               -433.25,
//                               663.07,
//                               -444.31,
//                               92.22,
//                               -176.92,
//                               613.93,
//                               -939.6,
//                               679.15,
//                               -202.46,
//                               375.93,
//                               -591.75,
//                               275.08,
//                               -233.15,
//                               563.96,
//                               -588.63,
//                               200.04,
//                               40.45,
//                               294.83,
//                               -827.61,
//                               863.28,
//                               -483.18,
//                               313.94,
//                               -443.0,
//                               584.23,
//                               -560.03,
//                               445.29,
//                               -398.87,
//                               386.79,
//                               -367.25,
//                               298.13,
//                               -163.89,
//                               83.03,
//                               -80.85,
//                               90.74,
//                               -203.36,
//                               394.43,
//                               -417.29,
//                               349.85,
//                               -443.68,
//                               636.11,
//                               -760.96,
//                               729.44,
//                               -532.79,
//                               285.13,
//                               -228.88,
//                               535.84,
//                               -668.94,
//                               229.13,
//                               216.55,
//                               -399.91,
//                               354.55,
//                               -138.69,
//                               76.78,
//                               -31.79,
//                               -194.96,
//                               349.12,
//                               -492.59,
//                               468.95,
//                               -255.33,
//                               733.13,
//                               -1179.97,
//                               565.62,
//                               -130.85,
//                               374.04,
//                               -278.03,
//                               -192.71,
//                               281.02,
//                               110.15,
//                               -501.14,
//                               454.56,
//                               -261.58,
//                               482.47,
//                               -656.17,
//                               376.12,
//                               -43.45,
//                               40.52,
//                               -377.21,
//                               446.85,
//                               -141.04,
//                               51.59,
//                               -144.24,
//                               102.58,
//                               59.97,
//                               -71.66,
//                               -140.48,
//                               138.24,
//                               240.41,
//                               -281.12,
//                               -446.41,
//                               1051.82,
//                               -249.67,
//                               -1583.51,
//                               2125.23,
//                               -838.98,
//                               -152.68,
//                               -13.57,
//                               371.87,
//                               -284.13,
//                               -110.89,
//                               512.31,
//                               -632.47,
//                               361.43,
//                               -8.48,
//                               -90.86,
//                               -132.57,
//                               418.71,
//                               -518.29,
//                               568.19,
//                               -607.07,
//                               499.57,
//                               -241.86,
//                               -3.04,
//                               -64.86,
//                               321.01,
//                               -338.31,
//                               253.68,
//                               -345.33,
//                               524.25,
//                               -784.56,
//                               977.59,
//                               -828.57,
//                               557.48,
//                               -378.65,
//                               212.71,
//                               -168.95,
//                               376.08,
//                               -603.67,
//                               588.01,
//                               -922.61,
//                               1807.39,
//                               -1805.53,
//                               732.14,
//                               -45.13,
//                               47.66,
//                               -148.74,
//                               118.93,
//                               -170.31,
//                               371.95,
//                               -480.14,
//                               417.13,
//                               -285.62,
//                               242.2,
//                               -284.05,
//                               475.19,
//                               -981.32,
//                               1264.48,
//                               -1007.87,
//                               762.31,
//                               -741.75,
//                               693.67,
//                               -393.12,
//                               44.22,
//                               21.19,
//                               166.61,
//                               -443.62,
//                               807.94,
//                               -1240.61,
//                               1139.98,
//                               -523.46,
//                               -4.74,
//                               459.02,
//                               -524.49,
//                               -90.49,
//                               110.78,
//                               838.11,
//                               -737.18,
//                               -345.34,
//                               676.32,
//                               -161.42,
//                               -238.73,
//                               -65.05,
//                               176.79,
//                               505.43,
//                               -1233.19,
//                               1059.28,
//                               -80.61,
//                               -517.06,
//                               245.47,
//                               56.13,
//                               572.61,
//                               -1716.6,
//                               2097.21,
//                               -1507.82,
//                               897.82,
//                               -614.12,
//                               628.43,
//                               -681.96,
//                               -79.33,
//                               582.62,
//                               170.49,
//                               -470.93,
//                               -30.53,
//                               94.99,
//                               148.59,
//                               -203.02,
//                               266.29,
//                               -355.05,
//                               103.97,
//                               35.57,
//                               408.2,
//                               -589.87,
//                               174.41,
//                               79.26,
//                               68.11,
//                               -272.16,
//                               273.99,
//                               -125.3,
//                               108.39,
//                               -463.97,
//                               1004.24,
//                               -894.73,
//                               -12.27,
//                               49.87,
//                               935.05,
//                               -640.48,
//                               -871.61,
//                               1331.76,
//                               -1231.58,
//                               1973.47,
//                               -1310.09,
//                               -677.13,
//                               578.58,
//                               392.79,
//                               -246.47,
//                               257.0,
//                               -177.17,
//                               -996.37,
//                               1627.13,
//                               -563.25,
//                               -599.29,
//                               406.96,
//                               738.96,
//                               -617.77,
//                               -1254.11,
//                               1493.83,
//                               596.83,
//                               -1804.33,
//                               1051.53,
//                               119.5,
//                               -590.2,
//                               292.44,
//                               -376.52,
//                               241.95,
//                               -539.5
//                              ]

    List<Double> countArma(List<Double> sample) {
        List<Double> value = []
        List<Double> valueList = sample
        for (int i = 373; i < valueList.size(); i++) {
            Double z1 = valueList.get(i - 1) - valueList.get(i - 365) + valueList.get(i - 366)
            Double z2 = 1.0324 * (valueList.get(i - 1) - valueList.get(i - 2) - valueList.get(i - 366) + valueList.get(i - 367))
            Double z3 = 0.3248 * (valueList.get(i - 2) - valueList.get(i - 3) - valueList.get(i - 367) + valueList.get(i - 368))
            Double z4 = 0.3248 * (valueList.get(i - 3) - valueList.get(i - 4) - valueList.get(i - 368) + valueList.get(i - 369))
            Double z5 = -2.8571 * (valueList.get(i - 4) - valueList.get(i - 5) - valueList.get(i - 369) + valueList.get(i - 370))
            Double a = 0
            Double a1 = 0
            Double a2 = 0
            if (value.size() != 0) {
                a1 = value.get(i - 374)
            }
            if (value.size() > 1) {
                a1 = 0.4137 * value.get(i - 375)
            }
            if (value.size() > 2) {
                a1 = 0.4137 * value.get(i - 376)
            }
            Double z = z1 - z2 - z3 - z4 - z5 + a - a1 - a2
            value.add(z)
        }
        return value
    }


    @SuppressWarnings("ALL")
    List<DayValue> transformsSample(List<DayValue> date, Map<String, ?> response) {
        List<DayValue> data = []
        response.get('Value').get('sample').eachWithIndex { el, idx ->
            DayValue dayValue = date.get(idx)
            dayValue.setValue(el as Double)
            dayValue.setDegree(response.get('Degree').get('sample').get(idx) as Double)
            data.add(dayValue)
        }
        return data
    }


    Map<String, ?> calculateArima(Long fileId, List<Double> valueList, List<Double> degreeList) {
        List<DayValue> dataByFile = DayValue.findAllByFile(fileService.getFile(fileId))
        List<DayValue> response = []
        List<Double> valueForecast = countArma(valueList)
        List<Double> degreeForecast = countArma(degreeList)

        def body = [
                noise: dataByFile*.getDegree(),
                ar   : 4,
                ma   : 2,
                isR   : true
        ]
        pythonRunService.sendToMathServer(body, 'countArima') as List<Double>

        def (noiseData, noiseForecast) = noiseService.countNoiseFunction(valueForecast, degreeForecast, dataByFile)

        dataByFile.eachWithIndex { DayValue entry, int i ->
            if (i > Lag && i < (Lag + valueForecast.size())) {
                entry.valueForecast = valueForecast.get(i - Lag)
                entry.degreeForecast = degreeForecast.get(i - Lag)
                entry.noiseForecast = noiseForecast.get(i - Lag) as Double
            }
            response.add(entry)
        }
        return [
                fileId   : fileId,
                data     : response,
                noiseData: noiseData
        ]
    }

    @SuppressWarnings("ALL")
    Map<String, ?> calculate(Calculations calculations) {
        List<DayValue> dataByFile = DayValue.findAllByFile(fileService.getFile(calculations.getFileId()))
        List<DayValue> dataByRequest = calculations.getSample()
        List<DayValue> data = dataByRequest ? dataByRequest : dataByFile
        Map<String, ?> response = [:]
        calculations.goalList.forEach({ it ->
            String type = it.capitalize()
            response.put(type, calculationFlow(calculations, data*."get${type}"()) as Object)
        })
        return [
                data      : transformsSample(data, response),
                valueList : response.get('Value'),
                degreeList: response.get('Degree'),
        ]
    }

    @SuppressWarnings("ALL")
    Map<String, ?> calculationFlow(Calculations calculations, List sample) {
        if (calculations.getConversion() != null) {
            sample = reformationService.reformat(calculations.getConversion(), sample)
        }
        Map<String, Double> generalCoefficients = coefficientService.countGeneralCoefficient(sample)
        Map<String, ?> demandsMap = [:]
        calculations.demands.forEach({ it ->
            String functionName = it.toLowerCase()
            if (ScriptConstants.availableFunction.contains(functionName)) {
                demandsMap.put(functionName, PythonRunService.sendToMathServer(sample, functionName) as Object)
            }
        })
        return [
                sample      : sample,
                coefficients: generalCoefficients,
                demands     : demandsMap
        ]
    }
}
